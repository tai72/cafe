{% extends 'base.html' %}

{% load static %}

{% load account %}

{% block title %}Ajax{% endblock title %}

{% block contents %}
<section class="sectionContact">
    <div class="wrapperHeader">
        <h2>書籍を調べよう</h2>
    </div>
    <div class="wrapperForm">
        <form action="" method="post">
            {% csrf_token %}

            {{ form.non_field_errors }}

            {% for field in form %}
            <div class="formContent">
                <p>{{ field.label_tag }}</p>
                {{ field }}
                {{ field.errors }}
            </div>
            {% endfor %}
            <button type="submit">送 信</button>
        </form>
    </div>
    <div id="result"></div>
    <a class="backToHome" href="{% url 'cafe_app:index' %}">＜＜＜ホームに戻る</a>
</section>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    // 送信ボタンにイベントリスナーを設置。内部にAjax処理を追加。
    $('form').submit(function(event) {
        // submitイベントの発生元のフォームが持つデフォルトの動作をキャンセルできる。
        // これを記述することで、送信ボタンを押した際にリロードされてしまうのを妨げる（prevent）ことができる。
        event.preventDefault();

        var form = $(this);
        $.ajax({
            url: form.prop('action'), 
            method: form.prop('method'), 
            data: form.serialize(), 
            timeout: 10000, 
            dataType: 'json', 
        })
        .done(function(data) {
            // alert(JSON.stringify(data));
            $.each(data.title, function(index, value) {
                $('#result').append('<p>' + value + '</p>');
            });
            $('#result').append('<p><br><br></p>');
        });
    });
</script>
{% endblock contents %}
